{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the BeachPal application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "fullName": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "cpf": {
          "type": "string",
          "description": "The user's CPF (Brazilian individual taxpayer registry number)."
        },
        "address": {
          "type": "string",
          "description": "The user's address."
        },
        "isTentOwner": {
          "type": "boolean",
          "description": "Indicates whether the user is a beach tent owner."
        },
        "googleId": {
          "type": "string",
          "description": "The user's Google ID, used for login with Google."
        }
      },
      "required": [
        "id",
        "fullName",
        "email",
        "cpf",
        "address",
        "isTentOwner"
      ]
    },
    "BeachTent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BeachTent",
      "type": "object",
      "description": "Represents a beach tent managed by a tent owner.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the beach tent."
        },
        "ownerId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N BeachTent)"
        },
        "name": {
          "type": "string",
          "description": "The name of the beach tent."
        },
        "latitude": {
          "type": "number",
          "description": "The latitude coordinate of the tent's location."
        },
        "longitude": {
          "type": "number",
          "description": "The longitude coordinate of the tent's location."
        },
        "photoGallery": {
          "type": "array",
          "description": "Array of URLs for photos of the beach tent.",
          "items": {
            "type": "string"
          }
        },
        "availableUmbrellas": {
          "type": "number",
          "description": "Number of available umbrellas for rent."
        },
        "availableChairs": {
          "type": "number",
          "description": "Number of available chairs for rent."
        }
      },
      "required": [
        "id",
        "ownerId",
        "name",
        "latitude",
        "longitude"
      ]
    },
    "MenuItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MenuItem",
      "type": "object",
      "description": "Represents an item on the beach tent's menu.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the menu item."
        },
        "beachTentId": {
          "type": "string",
          "description": "Reference to BeachTent. (Relationship: BeachTent 1:N MenuItem)"
        },
        "name": {
          "type": "string",
          "description": "The name of the menu item."
        },
        "description": {
          "type": "string",
          "description": "A description of the menu item."
        },
        "price": {
          "type": "number",
          "description": "The price of the menu item."
        }
      },
      "required": [
        "id",
        "beachTentId",
        "name",
        "price"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Order)"
        },
        "beachTentId": {
          "type": "string",
          "description": "Reference to BeachTent. (Relationship: BeachTent 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "The date and time the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount of the order."
        },
        "orderItems": {
          "type": "array",
          "description": "Items included in the order.  Stores the MenuItem IDs.",
          "items": {
            "type": "string"
          }
        },
        "status": {
          "type": "string",
          "description": "The status of the order (e.g., pending, confirmed, completed, cancelled)."
        }
      },
      "required": [
        "id",
        "customerId",
        "beachTentId",
        "orderDate",
        "totalAmount",
        "status"
      ]
    },
    "Reservation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reservation",
      "type": "object",
      "description": "Represents a table and chair reservation made by a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the reservation."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Reservation)"
        },
        "beachTentId": {
          "type": "string",
          "description": "Reference to BeachTent. (Relationship: BeachTent 1:N Reservation)"
        },
        "reservationDate": {
          "type": "string",
          "description": "The date and time for the reservation.",
          "format": "date-time"
        },
        "numberOfTables": {
          "type": "number",
          "description": "The number of tables reserved."
        },
        "numberOfChairs": {
          "type": "number",
          "description": "The number of chairs reserved."
        },
        "kitType": {
          "type": "string",
          "description": "Predefined Kit of 2 chairs.",
          "format": "string"
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount for the reservation."
        },
        "status": {
          "type": "string",
          "description": "The status of the reservation (e.g., pending, confirmed, completed, cancelled)."
        }
      },
      "required": [
        "id",
        "customerId",
        "beachTentId",
        "reservationDate",
        "totalAmount",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data. Path-based ownership ensures only the user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/beachTents/{beachTentId}",
        "definition": {
          "entityName": "BeachTent",
          "schema": {
            "$ref": "#/backend/entities/BeachTent"
          },
          "description": "Stores beach tent data.  The `ownerId` field is used for authorization. To enable atomic operations and list operations this value must also exist on every document of any subcollections.",
          "params": [
            {
              "name": "beachTentId",
              "description": "The unique identifier for the beach tent."
            }
          ]
        }
      },
      {
        "path": "/beachTents/{beachTentId}/menuItems/{menuItemId}",
        "definition": {
          "entityName": "MenuItem",
          "schema": {
            "$ref": "#/backend/entities/MenuItem"
          },
          "description": "Stores menu items for a specific beach tent. Access is controlled by the parent BeachTent document's `ownerId`. This value must be copied down to all child documents to avoid using `get()` in rules.",
          "params": [
            {
              "name": "beachTentId",
              "description": "The unique identifier for the beach tent."
            },
            {
              "name": "menuItemId",
              "description": "The unique identifier for the menu item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order data for a specific user. Path-based ownership ensures only the user can access their own orders.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/reservations/{reservationId}",
        "definition": {
          "entityName": "Reservation",
          "schema": {
            "$ref": "#/backend/entities/Reservation"
          },
          "description": "Stores reservation data for a specific user. Path-based ownership ensures only the user can access their own reservations.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "reservationId",
              "description": "The unique identifier for the reservation."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the BeachPal application's core features, focusing on user authentication, beach tent management, online ordering, real-time location tracking, and reservations. The primary goal is to ensure security, scalability, and ease of debugging, particularly concerning authorization.  \n\nAuthorization Independence is achieved through path-based ownership for private user data (UserProfile, Orders, Reservations) and explicit denormalization of ownership for BeachTents and MenuItems. This eliminates the need for `get()` calls in security rules, enabling atomic operations and simplifying authorization logic.\n\nStructural Segregation is implemented by placing user-specific data (orders, reservations) under the `/users/{userId}` path, separating it from global data like beach tents. BeachTents and MenuItems use Membership Maps to manage access control, ensuring only tent owners can modify their respective data.\n\nQAPs are supported by:\n\n1.  Segregating data with different access requirements into separate collections. For example, user profiles are stored in `/users/{userId}`, while beach tents are stored in `/beachTents/{beachTentId}`.\n2.  Using path-based ownership (`/users/{userId}/orders/{orderId}`) for user-specific data, making it easy to secure list operations for a specific user's orders.\n3.  Employing membership maps (denormalized) in the BeachTent documents to control access to tent-related operations. This ensures that only members with appropriate roles can perform specific actions on the tent data.\n\nData Clarity and Predictability are achieved through consistent naming conventions (e.g., `ownerId` for ownership), explicit state modeling (e.g., `status` field in Orders and Reservations), and a predictable schema (avoiding dynamic keys)."
  }
}
    